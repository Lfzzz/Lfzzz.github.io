function insertAtCursor(e,t){const n=e.selectionStart,o=e.selectionEnd;if(console.log(document.selection,n,o),document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(n||"0"==n){var i=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=i}else e.value+=t,e.focus()}console.log("Codes uses GPL Licence");let rmf={};function popupMenu(){window.oncontextmenu=function(e){if("flex"===$("#rightmenu-mask").css("display"))return RemoveRightMenu(!1),!1;if($("#rightmenu-mask").attr("style","display: flex"),window.addEventListener("scroll",(function(){if("flex"===$("#rightmenu-mask").css("display"))return RemoveRightMenu(!1),!1})),e.ctrlKey)return!0;$(".rightMenu-group.hide").hide(),document.getSelection().toString()&&$("#menu-text").show(),(document.getElementById("post")||document.getElementById("page"))&&$("#menu-post").show();var t=window.document.body;t=e.target;/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\*\+,;=.]+$/.test(window.getSelection().toString())&&$("#menu-too").show(),"A"==t.tagName&&(console.log(t.href),"javascript:void(0);"!=t.href&&""!=t.href&&"javascript:void(0)"!=t.href&&$("#menu-to").show(),rmf.open=function(){RemoveRightMenu(!1),location.href=t.href},rmf.openWithNewTab=function(){RemoveRightMenu(!1),setTimeout((()=>{window.open(t.href)}),500)},rmf.copyLink=function(){RemoveRightMenu(!1);let e=t.href,n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("Copy"),document.body.removeChild(n),btf.snackbarShow("✨成功入侵你的剪切板")}),"IMG"==t.tagName?(t.parentNode.href!=t.src?document.querySelector("#menu-img .rightMenu-item:nth-child(3)").style="display:none;":document.querySelector("#menu-img .rightMenu-item:nth-child(3)").style="display:block;",$("#menu-img").show(),rmf.openWithNewTab=function(){RemoveRightMenu(!1),setTimeout((()=>{window.open(t.src)}),500)},rmf.click=function(){RemoveRightMenu(!1),t.click()},rmf.copyLink=function(){RemoveRightMenu(!1);let e=t.src,n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("Copy"),document.body.removeChild(n)},rmf.saveImage=function(){RemoveRightMenu(!1);const e=`${`${t.src}?t=${(new Date).getTime()}`}?t=${(new Date).getTime()}`;fetch(e).then((e=>{e.blob().then((e=>{const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="伴舟先生大霖子博客的图片",n.click(),n.remove()}))}))}):"TEXTAREA"!=t.tagName&&"INPUT"!=t.tagName||"ais-SearchBox-input"==t.getAttribute("class")||($("#menu-paste").show(),rmf.paste=function(){navigator.permissions.query({name:"clipboard-read"}).then((e=>{"granted"==e.state||"prompt"==e.state?navigator.clipboard.readText().then((e=>{insertAtCursor(t,e),RemoveRightMenu(!1)})):btf.snackbarShow("💥请允许读取剪贴板！")}))});let n=e.clientX+10,o=e.clientY,i=$("#rightMenu").width(),c=$("#rightMenu").height();return n+i>window.innerWidth&&(n-=i+10),o+c>window.innerHeight&&(o-=o+c-window.innerHeight),rmf.showRightMenu(!0,o,n),!1}}rmf.showRightMenu=function(e,t=0,n=0){let o=$("#rightMenu");o.css("top",t+"px").css("left",n+"px"),e?o.show():o.hide()},rmf.switchDarkMode=function(){RemoveRightMenu(!1);"light"===("dark"===document.documentElement.getAttribute("data-theme")?"dark":"light")?(activateDarkMode(),saveToLocal.set("theme","dark",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)):(activateLightMode(),saveToLocal.set("theme","light",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)),"function"==typeof utterancesTheme&&utterancesTheme(),"object"==typeof FB&&window.loadFBComment(),window.DISQUS&&document.getElementById("disqus_thread").children.length&&setTimeout((()=>window.disqusReset()),200)},rmf.copyWordsLink=function(){RemoveRightMenu(!1);let e=window.location.href,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("Copy"),document.body.removeChild(t),btf.snackbarShow("✨成功入侵你的剪切板")},rmf.switchReadMode=function(){RemoveRightMenu(!1);const e=document.body;e.classList.add("read-mode");const t=document.createElement("button");t.type="button",t.className="fas fa-sign-out-alt exit-readmode",e.appendChild(t),t.addEventListener("click",(function n(){e.classList.remove("read-mode"),t.remove(),t.removeEventListener("click",n)}))},rmf.copySelect=function(){RemoveRightMenu(!1),document.execCommand("Copy",!1,null),btf.snackbarShow("✨成功入侵你的剪切板")},rmf.scrollToTop=function(){btf.scrollToDest(0,500)},rmf.translate=function(){RemoveRightMenu(!1),document.getElementById("translateLink").click()},document.onkeydown=function(e){17!=(e=e||window.event).keyCode||console.log("你知道的太多了")},navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)||popupMenu();const box=document.documentElement;function addLongtabListener(e,t){let n=0;e.ontouchstart=()=>{n=0,n=setTimeout((()=>{t(),n=0}),380)},e.ontouchmove=()=>{clearTimeout(n),n=0},e.ontouchend=()=>{n&&clearTimeout(n)}}function RemoveRightMenu(){rmf.showRightMenu(!1),$("#rightmenu-mask").attr("style","display: none")}addLongtabListener(box,popupMenu);